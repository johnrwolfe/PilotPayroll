-- BP 7.1.6 content: Package syschar: 3 persistence-version: 7.1.6

INSERT INTO EP_PKG
	VALUES ("42385522-1c5f-4df9-9de6-3cd5ff2b1211",
	"00000000-0000-0000-0000-000000000000",
	"5713191d-1d3c-41cb-add1-1cce3729acf2",
	'DataMarshalling',
	'',
	0);
INSERT INTO GD_MD
	VALUES ("72378a00-8e97-4279-8b6f-a2fd67ee8d08",
	112,
	"42385522-1c5f-4df9-9de6-3cd5ff2b1211",
	108,
	0,
	0,
	1,
	1,
	1,
	12,
	1,
	0,
	0,
	0,
	0,
	0,
	'4.1.17',
	'PilotPayroll::Components::PayrollMgmt::DataMarshalling');
INSERT INTO DIM_DIA
	VALUES ("72378a00-8e97-4279-8b6f-a2fd67ee8d08",
	'',
	1.000000,
	0.000000,
	0.000000,
	"00000000-0000-0000-0000-000000000000");
INSERT INTO S_SYNC
	VALUES ("d02f6ae0-5a9d-4e8d-b2ba-0f4897ccd9a4",
	"00000000-0000-0000-0000-000000000000",
	'MarshalPayroll',
	'',
	'select any dept from instances of Department where ( selected.Name == param.Dept );
if ( empty dept )
  LOG::LogFailure( message:"Department name not matched in Send Payroll" );
  return;
end if;
select many employees related by dept->Employee[R6.''employs''];
for each emp in employees
  select many payments related by emp->EmployeePayment[R7]
                                     ->EmployeePaymentElement[R15.''is composed of''];
  for each payment in payments
	hold = False;
	select one payroll related by payment->Payroll[R29.''is on hold for''];
	if ( not_empty payroll )
	  hold = True;
	end if;  	
    if ( param.Holds == False ) or ( hold == True )
  	  select one spec related by payment->PaymentStructureElement[R13.''is current realization of'']
  	                                  ->PaymentElementSpec[R12.''is typed by''];
      create object instance entry of PayrollItem;
      entry.ID = emp.NationalID;
      entry.Label = spec.Label;
      entry.Amount = payment.Amount;
      entry.Hold = hold;
    end if;	
  end for;
end for;

select many items from instances of PayrollItem;
send USER::Payroll( Department:dept.Name, EntrySet:items );

',
	"ba5eda7a-def5-0000-0000-000000000000",
	1,
	'',
	0);
INSERT INTO S_SPARM
	VALUES ("01898846-dc9a-4a4c-b295-fb92bf20c24c",
	"d02f6ae0-5a9d-4e8d-b2ba-0f4897ccd9a4",
	'Dept',
	"ba5eda7a-def5-0000-0000-000000000004",
	0,
	'',
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO S_SPARM
	VALUES ("bc5c13e4-7ef7-47c2-a3f0-ec73fc370f24",
	"d02f6ae0-5a9d-4e8d-b2ba-0f4897ccd9a4",
	'Holds',
	"ba5eda7a-def5-0000-0000-000000000001",
	0,
	'',
	"01898846-dc9a-4a4c-b295-fb92bf20c24c",
	'');
INSERT INTO PE_PE
	VALUES ("d02f6ae0-5a9d-4e8d-b2ba-0f4897ccd9a4",
	1,
	"42385522-1c5f-4df9-9de6-3cd5ff2b1211",
	"00000000-0000-0000-0000-000000000000",
	1);
INSERT INTO S_SYNC
	VALUES ("1e4bfa68-bb78-4314-90ca-c3a1dd322805",
	"00000000-0000-0000-0000-000000000000",
	'UnmarshallitemHolds',
	'',
	'select any dept from instances of Department
 where ( selected.Name == param.Dept );
if ( empty dept )
  LOG::LogFailure( message:"Department not found when specifing item holds" );
  return;
end if;
select one payroll related by dept->Payroll[R34.''needs current evaluation of''];
if ( empty payroll )
  LOG::LogFailure( message:"Payroll not found when specifing item holds" );
  return;
end if;

entries = param.EntrySet;

for each entry in entries;
  select any employee from instances of Employee
   where ( selected.NationalID == entry.ID );
  if ( not_empty employee )
  	select one payroll related by employee->EmployeePayment[R7]
  	                                      ->Payroll[R7.''is on''];
  	select many elements related by employee->EmployeePayment[R7]
  	                                        ->EmployeePaymentElement[R15.''is composed of''];
    for each elmt in elements
      select one spec related by elmt->PaymentStructureElement[R13.''is current realization of'']
                                    ->PaymentElementSpec[R12.''is typed by''];
      if ( spec.Label == entry.Label );
      	  select one pr related by elmt->Payroll[R29.''is on hold for''];
      	if ( entry.Hold )
      	  if ( empty pr )
      	  	relate elmt to payroll across R29.''is on hold for'';
      	  end if;
      	else
      	  if ( not_empty pr )
      	  	unrelate elmt from pr across R29.''is on hold for'';
      	  end if;
      	end if;
      end if;
    end for; 
  end if;
end for;
generate Payroll7:Reviewed() to payroll; 	                                      
',
	"ba5eda7a-def5-0000-0000-000000000000",
	1,
	'',
	0);
INSERT INTO S_SPARM
	VALUES ("4c8dcbb8-e388-4f74-950f-7fb30a7bfc4d",
	"1e4bfa68-bb78-4314-90ca-c3a1dd322805",
	'Dept',
	"ba5eda7a-def5-0000-0000-000000000004",
	0,
	'',
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO S_SPARM
	VALUES ("f56aaeaa-c93d-4d06-9ec1-1bdc4f87f93c",
	"1e4bfa68-bb78-4314-90ca-c3a1dd322805",
	'EntrySet',
	"7d341a7e-03e6-4b0e-95a2-f11c9b953e15",
	0,
	'',
	"4c8dcbb8-e388-4f74-950f-7fb30a7bfc4d",
	'');
INSERT INTO S_DT_PROXY
	VALUES ("7d341a7e-03e6-4b0e-95a2-f11c9b953e15",
	"00000000-0000-0000-0000-000000000000",
	'inst_ref_set<PayrollItem>',
	'',
	'',
	'../../../../../../MarshallingData/models/MarshallingData/Shared/Shared.xtuml');
INSERT INTO PE_PE
	VALUES ("1e4bfa68-bb78-4314-90ca-c3a1dd322805",
	1,
	"42385522-1c5f-4df9-9de6-3cd5ff2b1211",
	"00000000-0000-0000-0000-000000000000",
	1);
INSERT INTO PE_PE
	VALUES ("42385522-1c5f-4df9-9de6-3cd5ff2b1211",
	1,
	"00000000-0000-0000-0000-000000000000",
	"7c6d191c-1502-4f72-9055-2069e5f671e6",
	7);
INSERT INTO C_C_PROXY
	VALUES ("7c6d191c-1502-4f72-9055-2069e5f671e6",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	'PayrollMgmt',
	'',
	0,
	"00000000-0000-0000-0000-000000000000",
	0,
	'',
	'../PayrollMgmt.xtuml');
INSERT INTO S_SYS_PROXY
	VALUES ("5713191d-1d3c-41cb-add1-1cce3729acf2",
	'PilotPayroll',
	1,
	'../../../PilotPayroll.xtuml');
